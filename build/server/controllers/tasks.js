// Generated by CoffeeScript 1.8.0
var Task, reindexer;

Task = require('../models/tasky');

reindexer = require('../lib/reindexer');

module.exports.reindexationMiddleware = function(req, res, next) {
  if (reindexer.isReindexing()) {
    return res.send(400, {
      error: "reindexation is occuring, retry later"
    });
  } else {
    return next();
  }
};

module.exports.all = function(req, res) {
  return Task.all(function(err, tasks) {
    return res.send(200, []);
  });
};

module.exports.create = function(req, res) {
  return Task.create(req.body, function(err, task) {
    if (err != null) {
      return res.send(500, "An error occured while creating a task -- " + err);
    } else {
      return res.send(201, task);
    }
  });
};

module.exports.fetch = function(req, res, next, id) {
  return Task.find(id, function(err, task) {
    if ((err != null) || (task == null)) {
      return res.send(404, {
        error: "Task not found"
      });
    } else {
      req.task = task;
      return next();
    }
  });
};

module.exports.update = function(req, res) {
  return req.task.updateAttributes(req.body, function(err, task) {
    if (err != null) {
      return res.send(500, "An error occured while updating a task -- " + err);
    } else {
      return res.send(200, task);
    }
  });
};

module.exports["delete"] = function(req, res) {
  return req.task.destroy(function(err) {
    if (err != null) {
      return res.send(500, "An error occured while deleting a task -- " + err);
    } else {
      return res.send(204, {
        success: true
      });
    }
  });
};

module.exports.reindex = function(req, res) {
  return reindexer.reindex(function(err, tasks) {
    if (err != null) {
      return res.send(500, {
        error: error
      });
    } else {
      return res.send(200, tasks);
    }
  });
};
